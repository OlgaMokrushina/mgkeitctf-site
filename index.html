<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MGKEITCTF ‚Äî –º–∏–Ω–∏-CTF (–ø—Ä–∞–∫—Ç–∏–∫–∞)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card { box-shadow: 0 10px 30px rgba(0,0,0,.12), inset 0 0 0 1px rgba(255,255,255,.06); }
    .glow { text-shadow: 0 0 20px rgba(59,130,246,.35); }
    .step { background: #0b1220; border: 1px solid #1f2a44; transition: transform .15s ease, box-shadow .15s ease; }
    .step-active { background: linear-gradient(90deg, #60a5fa, #a78bfa); color: #0b1220; font-weight: 700; box-shadow: 0 0 20px rgba(99,102,241,.45); transform: scale(1.02); }
    .confetti { position: fixed; top: -10px; width: 8px; height: 14px; opacity: .9; animation: fall linear forwards; }
    @keyframes fall { to { transform: translateY(110vh) rotate(360deg); opacity: .95; } }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏/—Å–æ—Å—Ç–æ—è–Ω–∏—è */
    .fade { animation: fadeIn .35s ease-out both; }
    .fade-msg { animation: fadeIn .25s ease-out both; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @media (prefers-reduced-motion: reduce){ .fade, .fade-msg { animation: none !important; } }

    input.flag { transition: border-color .2s ease, background-position .2s ease; }
    input.flag.ok { border-color: #10b981 !important; background-repeat: no-repeat; background-position: right .75rem center; padding-right: 2.5rem; background-size: 20px 20px; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2310b981' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 6L9 17l-5-5'/%3E%3C/svg%3E"); }
    input.flag.err { border-color: #f43f5e !important; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-slate-100">
  <header class="max-w-5xl mx-auto px-4 pt-10 pb-4">
    <h1 class="text-3xl md:text-4xl font-bold glow">MGKEITCTF ‚Äî —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –º–∏–Ω–∏-—Å–∞–π—Ç</h1>

    <!-- —Å—Ç—Ä–æ–∫–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º + –∫–Ω–æ–ø–∫–∞ –¢–µ–æ—Ä–∏—è -->
    <div class="mt-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <p class="text-slate-300 text-sm">
        –§–æ—Ä–º–∞—Ç —Ñ–ª–∞–≥–∞ <code class="px-1 rounded bg-slate-800">MGKEITCTF{...}</code>. –£—Ä–æ–≤–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–¥—ë—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
      </p>
      <a href="theory.html" class="inline-flex items-center bg-indigo-600 hover:bg-indigo-500 text-white text-sm px-4 py-2 rounded-lg transition">
        üìò –¢–µ–æ—Ä–∏—è CTF
      </a>
    </div>
  </header>

  <!-- –°—Ç–µ–ø–ø–µ—Ä -->
  <section class="max-w-5xl mx-auto px-4">
    <div class="grid grid-cols-3 gap-3">
      <button type="button" data-step="1" id="stepBtn1" class="step rounded-2xl p-3 text-center">–£—Ä–æ–≤–µ–Ω—å 1</button>
      <button type="button" data-step="2" id="stepBtn2" class="step rounded-2xl p-3 text-center">–£—Ä–æ–≤–µ–Ω—å 2</button>
      <button type="button" data-step="3" id="stepBtn3" class="step rounded-2xl p-3 text-center">–£—Ä–æ–≤–µ–Ω—å 3</button>
    </div>
  </section>

  <main class="max-w-5xl mx-auto px-4 py-8 space-y-6">
    <div class="flex gap-3 items-end">
      <label class="text-sm text-slate-300">–ù–∏–∫/–§–ò–û (–¥–ª—è –∑–∞—á—ë—Ç–∞):</label>
      <input id="user" type="text" placeholder="anon" class="rounded-2xl bg-slate-800/80 border border-slate-700 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
    </div>

    <!-- L1 -->
    <section id="level1" class="card rounded-3xl border border-slate-800 p-6 bg-slate-900/60">
      <h2 class="text-2xl font-semibold">–£—Ä–æ–≤–µ–Ω—å 1 ‚Äî Base64</h2>
      <p class="mt-1 text-slate-300">–î–µ–∫–æ–¥–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –∏ –≤–≤–µ–¥–∏—Ç–µ —Ñ–ª–∞–≥ —Ü–µ–ª–∏–∫–æ–º.</p>
      <div class="mt-4 p-4 rounded-xl bg-slate-800/70 font-mono select-all overflow-x-auto">TUdLRUlUQ1RGe2hlbGxvX3dvcmxkfQ==</div>
      <div class="mt-4 flex flex-col sm:flex-row gap-3">
        <input id="flag1" type="text" placeholder="MGKEITCTF{...}" class="flag w-full sm:flex-1 rounded-2xl bg-slate-800/80 border border-slate-700 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500 font-mono" />
        <button type="button" data-check="1" class="rounded-2xl px-5 py-3 bg-indigo-600 hover:bg-indigo-500 active:scale-[.99] transition">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      </div>
      <p id="msg1" class="mt-3 text-sm"></p>
      <div class="mt-4 hidden" id="next1">
        <button type="button" data-go="2" class="rounded-2xl px-5 py-3 bg-emerald-600 hover:bg-emerald-500">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 2 ‚Üì</button>
      </div>
    </section>

    <!-- L2 -->
    <section id="level2" class="card rounded-3xl border border-slate-800 p-6 bg-slate-900/40 hidden">
      <h2 class="text-2xl font-semibold">–£—Ä–æ–≤–µ–Ω—å 2 ‚Äî –°–¥–≤–∏–≥ –¶–µ–∑–∞—Ä—è</h2>
      <p class="mt-1 text-slate-300">–í–Ω—É—Ç—Ä–∏ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–æ–∫ –ø—Ä–∏–º–µ–Ω—ë–Ω —Å–¥–≤–∏–≥ <strong>+4</strong>. –í–µ—Ä–Ω–∏—Ç–µ –Ω–∞–∑–∞–¥.</p>
      <div class="mt-4 p-4 rounded-xl bg-slate-800/70 font-mono overflow-x-auto">MGKEITCTF{jmb_xli_psmkmg}</div>
      <details class="mt-3 text-slate-400"><summary class="cursor-pointer hover:text-slate-200">–ü–æ–¥—Å–∫–∞–∑–∫–∞</summary><div class="mt-2 text-slate-300">a‚Üíw, b‚Üíx, c‚Üíy, d‚Üíz, e‚Üía‚Ä¶</div></details>
      <div class="mt-4 flex flex-col sm:flex-row gap-3">
        <input id="flag2" type="text" placeholder="MGKEITCTF{...}" class="flag w-full sm:flex-1 rounded-2xl bg-slate-800/80 border border-slate-700 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500 font-mono" />
        <button type="button" data-check="2" class="rounded-2xl px-5 py-3 bg-indigo-600 hover:bg-indigo-500 active:scale-[.99] transition">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      </div>
      <p id="msg2" class="mt-3 text-sm"></p>
      <div class="mt-4 hidden" id="next2">
        <button type="button" data-go="3" class="rounded-2xl px-5 py-3 bg-emerald-600 hover:bg-emerald-500">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 3 ‚Üì</button>
      </div>
    </section>

    <!-- L3 -->
    <section id="level3" class="card rounded-3xl border border-slate-800 p-6 bg-slate-900/20 hidden">
      <h2 class="text-2xl font-semibold">–£—Ä–æ–≤–µ–Ω—å 3 ‚Äî –ü–æ–∏—Å–∫ –≤ –∫–æ–¥–µ</h2>
      <p class="mt-1 text-slate-300">–§–ª–∞–≥ —Å–ø—Ä—è—Ç–∞–Ω –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ù–∞–π–¥–∏—Ç–µ –∏ –≤–≤–µ–¥–∏—Ç–µ.</p>
      <!-- FULL FLAG FOR LEVEL 3: MGKEITCTF{web_warrior} -->
      <div id="flag-explicit" data-flag="MGKEITCTF{web_warrior}" style="display:none" aria-hidden="true"></div>
      <div class="mt-4 flex flex-col sm:flex-row gap-3">
        <input id="flag3" type="text" placeholder="MGKEITCTF{...}" class="flag w-full sm:flex-1 rounded-2xl bg-slate-800/80 border border-slate-700 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500 font-mono" />
        <button type="button" data-check="3" class="rounded-2xl px-5 py-3 bg-indigo-600 hover:bg-indigo-500 active:scale-[.99] transition">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      </div>
      <p id="msg3" class="mt-3 text-sm"></p>
      <div class="mt-4 hidden" id="next3">
        <button type="button" id="celebrateBtn" class="rounded-2xl px-5 py-3 bg-fuchsia-600 hover:bg-fuchsia-500">–£—Ä–∞! –ß—Ç–æ –¥–∞–ª—å—à–µ?</button>
      </div>
    </section>

    <!-- –§–∏–Ω–∞–ª -->
    <section id="finish" class="card rounded-3xl border border-slate-800 p-8 bg-slate-900/30 hidden text-center">
      <h2 class="text-3xl font-bold">–°—É–ø–µ—Ä! –¢—ã –ø—Ä–æ—à—ë–ª –≤—Å–µ —É—Ä–æ–≤–Ω–∏ üéâ</h2>
      <p class="mt-2 text-slate-300">–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ª—é–±–æ–º—É —É—Ä–æ–≤–Ω—é —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ.</p>
      <div class="mt-4 flex justify-center gap-3">
        <button type="button" id="resetBtn" class="rounded-2xl px-5 py-3 bg-slate-800 border border-slate-700 hover:bg-slate-700">–°–±—Ä–æ—Å–∏—Ç—å</button>
        <button type="button" id="moreConfetti" class="rounded-2xl px-5 py-3 bg-emerald-600 hover:bg-emerald-500">–ï—â—ë –∫–æ–Ω—Ñ–µ—Ç—Ç–∏</button>
      </div>
    </section>
  </main>

  <footer class="max-w-5xl mx-auto px-4 pb-12 text-slate-400 text-sm">
    <p>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä: –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –º–æ–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å –≤ HTML. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–æ–≤ ‚Äî —á–µ—Ä–µ–∑ Cloudflare Worker.</p>
  </footer>

  <script>
    // === –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    const CHECK_URL = "https://mgkeit-check.mokrushinaolllya.workers.dev";

    // === –£—Ç–∏–ª–∏—Ç—ã UI
    function markStepper(active) {
      for (let i = 1; i <= 3; i++) document.getElementById('stepBtn'+i).classList.remove('step-active');
      document.getElementById('stepBtn'+active).classList.add('step-active');
    }
    function showLevel(n) {
      for (let i = 1; i <= 3; i++) document.getElementById('level'+i).classList.add('hidden');
      const sec = document.getElementById('level'+n);
      sec.classList.remove('hidden');
      sec.classList.add('fade');
      sec.addEventListener('animationend', () => sec.classList.remove('fade'), { once: true });
      markStepper(n);
      localStorage.setItem('currentLevel', String(n));
      window.scrollTo({ top: sec.offsetTop - 20, behavior: 'smooth' });
    }
    function spawnConfetti() {
      const colors = ['#60a5fa','#a78bfa','#34d399','#f472b6','#f59e0b','#eab308'];
      for (let i=0;i<60;i++) {
        const d = document.createElement('div');
        d.className = 'confetti';
        d.style.left = Math.random()*100 + 'vw';
        d.style.background = colors[Math.floor(Math.random()*colors.length)];
        d.style.animationDuration = (1.5 + Math.random()*1.5) + 's';
        d.style.transform = 'rotate(' + (Math.random()*360) + 'deg)';
        document.body.appendChild(d);
        setTimeout(()=>d.remove(), 3000);
      }
    }

    // === –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞
    async function doCheck(level) {
      const input = document.getElementById('flag'+level);
      const msg = document.getElementById('msg'+level);
      const user = (document.getElementById('user').value || 'anon').trim();

      msg.textContent = '–ü—Ä–æ–≤–µ—Ä—è—é‚Ä¶';
      msg.className = 'mt-3 text-sm text-slate-300 fade-msg';

      try {
        const res = await fetch(CHECK_URL, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ flag: input.value.trim(), level, user })
        });
        const data = await res.json();
        if (data && data.ok) {
          input.classList.remove('err'); input.classList.add('ok');
          const texts = {1:'–ú–æ–ª–æ–¥–µ—Ü! –ü–µ—Ä–µ—Ö–æ–¥–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 2 ‚Üì', 2:'–û—Ç–ª–∏—á–Ω–æ! –ü–µ—Ä–µ—Ö–æ–¥–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 3 ‚Üì', 3:'–°—É–ø–µ—Ä! –¢—ã –ø—Ä–æ—à—ë–ª –≤—Å–µ —É—Ä–æ–≤–Ω–∏ üéâ'};
          msg.textContent = texts[level];
          msg.className = 'mt-3 text-sm text-emerald-400 fade-msg';

          if (level < 3) {
            document.getElementById('next'+level).classList.remove('hidden');
            setTimeout(()=>showLevel(level+1), 900);
          } else {
            document.getElementById('next3').classList.remove('hidden');
            document.getElementById('finish').classList.remove('hidden');
            spawnConfetti();
          }
        } else {
          input.classList.remove('ok'); input.classList.add('err');
          setTimeout(()=>input.classList.remove('err'), 1200);
          msg.textContent = '–ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç –∏ —Ä–µ—à–µ–Ω–∏–µ.';
          msg.className = 'mt-3 text-sm text-rose-400 fade-msg';
        }
      } catch (e) {
        input.classList.remove('ok'); input.classList.add('err');
        setTimeout(()=>input.classList.remove('err'), 1200);
        msg.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏.';
        msg.className = 'mt-3 text-sm text-rose-400 fade-msg';
      }
    }

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      // –ñ—ë—Å—Ç–∫–æ –æ—Ç–∫–ª—é—á–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏/–∏—Å—Ç–æ—Ä–∏—é –≤–≤–æ–¥–∞ —É –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
      const inputs = document.querySelectorAll('input[type="text"]');
      inputs.forEach((el, i) => {
        el.setAttribute('autocomplete','off');
        el.setAttribute('autocapitalize','off');
        el.setAttribute('autocorrect','off');
        el.setAttribute('spellcheck','false');
        el.setAttribute('name', `nohist_${Date.now()}_${i}_${Math.random().toString(36).slice(2,7)}`);
        el.setAttribute('readonly','readonly');
        el.addEventListener('focus', () => setTimeout(()=>el.removeAttribute('readonly'), 0), { once:true });
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–±–µ–∑ inline-–æ–Ω–∫–ª–∏–∫–æ–≤)
      document.querySelectorAll('[data-step]').forEach(btn => btn.addEventListener('click', () => showLevel(+btn.dataset.step)));
      document.querySelectorAll('[data-go]').forEach(btn => btn.addEventListener('click', () => showLevel(+btn.dataset.go)));
      document.querySelectorAll('[data-check]').forEach(btn => btn.addEventListener('click', () => doCheck(+btn.dataset.check)));

      document.getElementById('celebrateBtn')?.addEventListener('click', () => spawnConfetti());
      document.getElementById('resetBtn')?.addEventListener('click', () => { localStorage.removeItem('currentLevel'); location.reload(); });
      document.getElementById('moreConfetti')?.addEventListener('click', () => spawnConfetti());

      // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
      const saved = parseInt(localStorage.getItem('currentLevel')||'1',10);
      showLevel(isNaN(saved)?1:saved);
    });
  </script>
</body>
</html>
