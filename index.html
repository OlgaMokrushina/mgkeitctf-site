<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MGKEITCTF ‚Äî –ü—Ä–∞–∫—Ç–∏–∫–∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:radial-gradient(circle at 20% 20%, #141e3c 0%, #0a0f1e 70%); color:#e5e7eb; font-family:Inter, system-ui,-apple-system,Segoe UI,Roboto;}
    .card{background:rgba(10,15,30,.72); border:1px solid rgba(99,102,241,.18); border-radius:1.25rem; box-shadow:0 8px 30px rgba(2,6,23,.6), inset 0 0 8px rgba(99,102,241,.03);}
    .step{background:#0b1220; border:1px solid #1f2a44; transition:transform .15s, box-shadow .15s;}
    .step-active{background:linear-gradient(90deg,#60a5fa,#a78bfa); color:#0b1220; font-weight:700; box-shadow:0 0 20px rgba(99,102,241,.45); transform:scale(1.02);}
    .glow{ text-shadow:0 0 20px rgba(99,102,241,.45); }
    input.flag{transition:border-color .2s, background-position .2s;}
    input.flag.ok{border-color:#10b981!important; background-repeat:no-repeat; background-position:right .75rem center; padding-right:2.5rem; background-size:20px 20px; background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2310b981' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 6L9 17l-5-5'/%3E%3C/svg%3E");}
    input.flag.err{border-color:#f43f5e!important;}
    .confetti{position:fixed; top:-10px; width:8px; height:14px; opacity:.9; animation:fall linear forwards;}
    @keyframes fall{to{transform:translateY(110vh) rotate(360deg); opacity:.95}}
  </style>
</head>
<body>

<!-- Sticky top bar -->
<div class="fixed inset-x-0 top-0 z-40 backdrop-blur bg-slate-900/60 border-b border-slate-800">
  <div class="max-w-5xl mx-auto px-4 h-14 flex items-center justify-between">
    <div class="font-semibold">MGKEITCTF</div>
    <div class="flex gap-2">
      <a href="theory.html" class="px-3 py-1.5 rounded-lg bg-indigo-600 hover:bg-indigo-500">üìò –¢–µ–æ—Ä–∏—è</a>
      <a href="index.html" class="px-3 py-1.5 rounded-lg bg-slate-800 border border-slate-700">‚ö° –ü—Ä–∞–∫—Ç–∏–∫–∞</a>
    </div>
  </div>
</div>
<div style="height:56px"></div>

<header class="max-w-5xl mx-auto px-4 pt-8 pb-2">
  <h1 class="text-3xl md:text-4xl font-bold glow">MGKEITCTF ‚Äî —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –º–∏–Ω–∏-—Å–∞–π—Ç</h1>
  <div class="mt-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
    <p class="text-slate-300 text-sm">
      –§–æ—Ä–º–∞—Ç —Ñ–ª–∞–≥–∞ <code class="px-1 rounded bg-slate-800">MGKEITCTF{...}</code>. –£—Ä–æ–≤–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É, –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
    </p>
    <a href="theory.html" class="inline-flex items-center bg-indigo-600 hover:bg-indigo-500 text-white text-sm px-4 py-2 rounded-lg transition">
      üìò –¢–µ–æ—Ä–∏—è CTF
    </a>
  </div>
</header>

<!-- Stepper -->
<section class="max-w-5xl mx-auto px-4">
  <div class="grid grid-cols-3 gap-3">
    <button type="button" data-step="1" id="stepBtn1" class="step rounded-2xl p-3 text-center">–£—Ä–æ–≤–µ–Ω—å 1</button>
    <button type="button" data-step="2" id="stepBtn2" class="step rounded-2xl p-3 text-center">–£—Ä–æ–≤–µ–Ω—å 2</button>
    <button type="button" data-step="3" id="stepBtn3" class="step rounded-2xl p-3 text-center">–£—Ä–æ–≤–µ–Ω—å 3</button>
  </div>
</section>

<main class="max-w-5xl mx-auto px-4 py-6 space-y-6">
  <div class="flex gap-3 items-end">
    <label class="text-sm text-slate-300">–ù–∏–∫/–§–ò–û (–¥–ª—è –∑–∞—á—ë—Ç–∞):</label>
    <input id="user" type="text" placeholder="anon" class="rounded-2xl bg-slate-800/80 border border-slate-700 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
  </div>

  <!-- Level 1 -->
  <section id="level1" class="card p-6">
    <h2 class="text-2xl font-semibold">–£—Ä–æ–≤–µ–Ω—å 1 ‚Äî Base64</h2>
    <p class="mt-1 text-slate-300">–î–µ–∫–æ–¥–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –∏ –≤–≤–µ–¥–∏—Ç–µ —Ñ–ª–∞–≥ —Ü–µ–ª–∏–∫–æ–º.</p>
    <div class="mt-4 p-4 rounded-xl bg-slate-900/70 font-mono overflow-x-auto">TUdLRUlUQ1RGe2hlbGxvX3dvcmxkfQ==</div>
    <div class="mt-4 flex flex-col sm:flex-row gap-3">
      <input id="flag1" type="text" placeholder="MGKEITCTF{...}" class="flag w-full sm:flex-1 rounded-2xl bg-slate-800/80 border border-slate-700 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500 font-mono" />
      <button type="button" data-check="1" class="rounded-2xl px-5 py-3 bg-indigo-600 hover:bg-indigo-500 active:scale-[.99] transition">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    </div>
    <p id="msg1" class="mt-3 text-sm"></p>
    <div class="mt-4 hidden" id="next1">
      <button type="button" data-go="2" class="rounded-2xl px-5 py-3 bg-emerald-600 hover:bg-emerald-500">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 2 ‚Üì</button>
    </div>
  </section>

  <!-- Level 2 -->
  <section id="level2" class="card p-6 hidden">
    <h2 class="text-2xl font-semibold">–£—Ä–æ–≤–µ–Ω—å 2 ‚Äî –°–¥–≤–∏–≥ –¶–µ–∑–∞—Ä—è</h2>
    <p class="mt-1 text-slate-300">–í–Ω—É—Ç—Ä–∏ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–æ–∫ –ø—Ä–∏–º–µ–Ω—ë–Ω —Å–¥–≤–∏–≥ <strong>+4</strong>. –í–µ—Ä–Ω–∏—Ç–µ –Ω–∞–∑–∞–¥.</p>
    <div class="mt-4 p-4 rounded-xl bg-slate-900/70 font-mono overflow-x-auto">MGKEITCTF{jmb_xli_psmkmg}</div>
    <details class="mt-3 text-slate-400"><summary class="cursor-pointer hover:text-slate-200">–ü–æ–¥—Å–∫–∞–∑–∫–∞</summary><div class="mt-2 text-slate-300">a‚Üíw, b‚Üíx, c‚Üíy, d‚Üíz, e‚Üía‚Ä¶</div></details>
    <div class="mt-4 flex flex-col sm:flex-row gap-3">
      <input id="flag2" type="text" placeholder="MGKEITCTF{...}" class="flag w-full sm:flex-1 rounded-2xl bg-slate-800/80 border border-slate-700 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500 font-mono" />
      <button type="button" data-check="2" class="rounded-2xl px-5 py-3 bg-indigo-600 hover:bg-indigo-500 active:scale-[.99] transition">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    </div>
    <p id="msg2" class="mt-3 text-sm"></p>
    <div class="mt-4 hidden" id="next2">
      <button type="button" data-go="3" class="rounded-2xl px-5 py-3 bg-emerald-600 hover:bg-emerald-500">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 3 ‚Üì</button>
    </div>
  </section>

  <!-- Level 3 -->
  <section id="level3" class="card p-6 hidden">
    <h2 class="text-2xl font-semibold">–£—Ä–æ–≤–µ–Ω—å 3 ‚Äî –ü–æ–∏—Å–∫ –≤ –∫–æ–¥–µ</h2>
    <p class="mt-1 text-slate-300">–§–ª–∞–≥ —Å–ø—Ä—è—Ç–∞–Ω –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ù–∞–π–¥–∏—Ç–µ –∏ –≤–≤–µ–¥–∏—Ç–µ.</p>
    <!-- FULL FLAG FOR LEVEL 3: MGKEITCTF{web_warrior} -->
    <div id="flag-explicit" data-flag="MGKEITCTF{web_warrior}" style="display:none" aria-hidden="true"></div>
    <div class="mt-4 flex flex-col sm:flex-row gap-3">
      <input id="flag3" type="text" placeholder="MGKEITCTF{...}" class="flag w-full sm:flex-1 rounded-2xl bg-slate-800/80 border border-slate-700 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500 font-mono" />
      <button type="button" data-check="3" class="rounded-2xl px-5 py-3 bg-indigo-600 hover:bg-indigo-500 active:scale-[.99] transition">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    </div>
    <p id="msg3" class="mt-3 text-sm"></p>
    <div class="mt-4 hidden" id="next3">
      <button type="button" id="celebrateBtn" class="rounded-2xl px-5 py-3 bg-fuchsia-600 hover:bg-fuchsia-500">–£—Ä–∞! –ß—Ç–æ –¥–∞–ª—å—à–µ?</button>
    </div>
  </section>

  <!-- –ê—á–∏–≤–∫–∏ -->
  <section class="max-w-5xl mx-auto">
    <div id="badges" class="flex flex-wrap gap-3"></div>
  </section>

  <!-- –ë—ã—Å—Ç—Ä—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã -->
  <section class="card p-6">
    <h3 class="text-xl font-semibold mb-4">üõ† –ë—ã—Å—Ç—Ä—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h3>
    <div class="grid md:grid-cols-3 gap-4">
      <!-- Base64 -->
      <div class="rounded-xl border border-slate-800 p-4 bg-slate-900/60">
        <div class="font-medium mb-2">Base64</div>
        <textarea id="b64in" class="w-full h-24 rounded-lg bg-slate-800 border border-slate-700 p-2 font-mono" placeholder="–¢–µ–∫—Å—Ç –∏–ª–∏ base64"></textarea>
        <div class="mt-2 flex gap-2">
          <button onclick="b64d()" class="px-3 py-1.5 rounded bg-slate-800 border border-slate-700">–î–µ–∫–æ–¥</button>
          <button onclick="b64e()" class="px-3 py-1.5 rounded bg-slate-800 border border-slate-700">–ö–æ–¥</button>
          <button onclick="copyTxt('#b64in')" class="px-3 py-1.5 rounded bg-slate-800 border border-slate-700">‚ßâ</button>
        </div>
      </div>
      <!-- Caesar -->
      <div class="rounded-xl border border-slate-800 p-4 bg-slate-900/60">
        <div class="font-medium mb-2">–°–¥–≤–∏–≥ –¶–µ–∑–∞—Ä—è</div>
        <input id="czshift" type="number" value="4" class="w-20 rounded bg-slate-800 border border-slate-700 p-2 mr-2"> 
        <textarea id="czin" class="w-full h-24 rounded-lg bg-slate-800 border border-slate-700 p-2 font-mono" placeholder="–¢–µ–∫—Å—Ç..."></textarea>
        <div class="mt-2 flex gap-2">
          <button onclick="cz(-1)" class="px-3 py-1.5 rounded bg-slate-800 border border-slate-700">–î–µ–∫—Ä.</button>
          <button onclick="cz(1)"  class="px-3 py-1.5 rounded bg-slate-800 border border-slate-700">–ò–Ω–∫—Ä.</button>
          <button onclick="copyTxt('#czin')" class="px-3 py-1.5 rounded bg-slate-800 border border-slate-700">‚ßâ</button>
        </div>
      </div>
      <!-- Hash -->
      <div class="rounded-xl border border-slate-800 p-4 bg-slate-900/60">
        <div class="font-medium mb-2">SHA-256 Hash</div>
        <textarea id="hbin" class="w-full h-24 rounded-lg bg-slate-800 border border-slate-700 p-2 font-mono" placeholder="–¢–µ–∫—Å—Ç..."></textarea>
        <div class="mt-2 flex gap-2">
          <button onclick="sha256btn()" class="px-3 py-1.5 rounded bg-slate-800 border border-slate-700">–•—ç—à</button>
          <button onclick="copyTxt('#hbin')" class="px-3 py-1.5 rounded bg-slate-800 border border-slate-700">‚ßâ</button>
        </div>
      </div>
    </div>
  </section>

  <!-- –§–∏–Ω–∞–ª + –ª–∏–¥–µ—Ä–±–æ—Ä–¥ -->
  <section id="finish" class="card p-8 hidden text-center">
    <h2 class="text-3xl font-bold">–°—É–ø–µ—Ä! –¢—ã –ø—Ä–æ—à—ë–ª –≤—Å–µ —É—Ä–æ–≤–Ω–∏ üéâ</h2>
    <p class="mt-2 text-slate-300">–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ª—é–±–æ–º—É —É—Ä–æ–≤–Ω—é –≤—ã—à–µ.</p>
    <div class="mt-4 flex justify-center gap-3">
      <button type="button" id="resetBtn" class="rounded-2xl px-5 py-3 bg-slate-800 border border-slate-700 hover:bg-slate-700">–°–±—Ä–æ—Å–∏—Ç—å</button>
      <button type="button" id="moreConfetti" class="rounded-2xl px-5 py-3 bg-emerald-600 hover:bg-emerald-500">–ï—â—ë –∫–æ–Ω—Ñ–µ—Ç—Ç–∏</button>
    </div>
  </section>

  <section class="card p-6">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-xl font-semibold">üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h3>
      <button id="lbRefresh" class="px-3 py-1.5 rounded bg-slate-800 border border-slate-700">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
    <div class="overflow-x-auto rounded-xl border border-slate-800">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-800/70">
          <tr><th class="px-3 py-2 text-left">–£—á–∞—Å—Ç–Ω–∏–∫</th><th class="px-3 py-2">–†–µ—à–µ–Ω–æ</th><th class="px-3 py-2">–ü–æ–ø—ã—Ç–æ–∫</th></tr>
        </thead>
        <tbody id="lbBody" class="divide-y divide-slate-800"></tbody>
      </table>
    </div>
  </section>
</main>

<footer class="max-w-5xl mx-auto px-4 pb-10 text-slate-400 text-sm">
  <p>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä: –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –º–æ–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å –≤ HTML. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–æ–≤ ‚Äî —á–µ—Ä–µ–∑ Cloudflare Worker.</p>
</footer>

<script>
  // === –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  const CHECK_URL = "https://mgkeit-check.mokrushinaolllya.workers.dev";
  const LB_URL = CHECK_URL + "/leaderboard";

  // —Ö–æ—Ç–∫–µ–∏
  document.addEventListener('keydown', (e)=>{
    if (['INPUT','TEXTAREA'].includes(document.activeElement.tagName) && e.key!=='Enter') return;
    if (e.key==='1') showLevel(1);
    if (e.key==='2') showLevel(2);
    if (e.key==='3') showLevel(3);
    if (e.key==='Enter') {
      const lvl = Number(localStorage.getItem('currentLevel')||1);
      document.querySelector(`[data-check="${lvl}"]`)?.click();
    }
    if (e.key.toLowerCase()==='t') location.href='theory.html';
  });

  function markStepper(active){ for (let i=1;i<=3;i++) document.getElementById('stepBtn'+i).classList.remove('step-active'); document.getElementById('stepBtn'+active).classList.add('step-active'); }
  function showLevel(n){
    for (let i=1;i<=3;i++) document.getElementById('level'+i).classList.add('hidden');
    document.getElementById('level'+n).classList.remove('hidden');
    markStepper(n); localStorage.setItem('currentLevel', String(n));
    window.scrollTo({ top: document.getElementById('level'+n).offsetTop - 10, behavior: 'smooth' });
  }
  function spawnConfetti(){
    const colors=['#60a5fa','#a78bfa','#34d399','#f472b6','#f59e0b','#eab308'];
    for (let i=0;i<60;i++){ const d=document.createElement('div'); d.className='confetti'; d.style.left=Math.random()*100+'vw'; d.style.background=colors[Math.floor(Math.random()*colors.length)]; d.style.animationDuration=(1.5+Math.random()*1.5)+'s'; d.style.transform='rotate('+(Math.random()*360)+'deg)'; document.body.appendChild(d); setTimeout(()=>d.remove(),3000);}
  }
  // –∞—á–∏–≤–∫–∏
  window.unlockBadge = function (id, title, emoji){
    const key='badge_'+id; if(localStorage.getItem(key)) return;
    localStorage.setItem(key, '1');
    const b=document.createElement('div');
    b.className='px-3 py-2 rounded-xl bg-emerald-600/20 border border-emerald-500/40';
    b.textContent=emoji+' '+title; document.getElementById('badges').appendChild(b);
    (function conf(){ for(let i=0;i<25;i++){ const d=document.createElement('div'); d.style.cssText=`position:fixed;top:-10px;left:${Math.random()*100}vw;width:8px;height:14px;background:hsl(${Math.random()*360} 80% 60%);opacity:.9;transform:rotate(${Math.random()*360}deg);transition:transform 1.5s linear, top 1.5s linear; z-index:9999;`; document.body.appendChild(d); setTimeout(()=>{ d.style.top='105vh'; d.style.transform+=' translateY(100vh)'; },10); setTimeout(()=>d.remove(),1600);} })();
  }

  // –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞
  async function doCheck(level){
    const input=document.getElementById('flag'+level);
    const msg=document.getElementById('msg'+level);
    const user=(document.getElementById('user').value||'anon').trim();

    msg.textContent='–ü—Ä–æ–≤–µ—Ä—è—é‚Ä¶'; msg.className='mt-3 text-sm text-slate-300';

    try{
      const res = await fetch(CHECK_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ flag: input.value.trim(), level, user }) });
      const data = await res.json();
      if (data && data.ok){
        input.classList.remove('err'); input.classList.add('ok');
        const texts={1:'–ú–æ–ª–æ–¥–µ—Ü! –ü–µ—Ä–µ—Ö–æ–¥–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 2 ‚Üì', 2:'–û—Ç–ª–∏—á–Ω–æ! –ü–µ—Ä–µ—Ö–æ–¥–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 3 ‚Üì', 3:'–°—É–ø–µ—Ä! –¢—ã –ø—Ä–æ—à—ë–ª –≤—Å–µ —É—Ä–æ–≤–Ω–∏ üéâ'};
        msg.textContent=texts[level]; msg.className='mt-3 text-sm text-emerald-400';
        if (level===1) unlockBadge('l1','–ü–µ—Ä–≤—ã–π —Ñ–ª–∞–≥!','ü•á');
        if (level===2) unlockBadge('l2','–î–≤–∞ –∏–∑ —Ç—Ä—ë—Ö!','ü•à');
        if (level===3) unlockBadge('l3','–°—Ç–∞–∂—ë—Ä-—Ö–∞–∫–µ—Ä','ü•≥');
        if (level<3){ document.getElementById('next'+level).classList.remove('hidden'); setTimeout(()=>showLevel(level+1), 900);}
        else { document.getElementById('next3').classList.remove('hidden'); document.getElementById('finish').classList.remove('hidden'); spawnConfetti(); }
      } else {
        input.classList.remove('ok'); input.classList.add('err'); setTimeout(()=>input.classList.remove('err'),1200);
        msg.textContent='–ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç –∏ —Ä–µ—à–µ–Ω–∏–µ.'; msg.className='mt-3 text-sm text-rose-400';
      }
    } catch(e){
      input.classList.remove('ok'); input.classList.add('err'); setTimeout(()=>input.classList.remove('err'),1200);
      msg.textContent='–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏.'; msg.className='mt-3 text-sm text-rose-400';
    }
  }

  // –ª–∏–¥–µ—Ä–±–æ—Ä–¥
  async function loadLB(){
    try{
      const {rows=[]}=await fetch(LB_URL).then(r=>r.json());
      const tb=document.getElementById('lbBody'); tb.innerHTML='';
      rows.forEach((r,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td class="px-3 py-2">${i+1}. ${r.user}</td><td class="px-3 py-2 text-center">${r.solved}</td><td class="px-3 py-2 text-center">${r.tries}</td>`;
        tb.appendChild(tr);
      });
    }catch{}
  }

  // —É—Ç–∏–ª–∏—Ç—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
  function copyTxt(sel){ const t=document.querySelector(sel); navigator.clipboard.writeText(t.value||''); }
  function b64d(){ const a=document.getElementById('b64in'); try{ a.value = atob(a.value.trim()); }catch{ alert('–ù–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ Base64'); } }
  function b64e(){ const a=document.getElementById('b64in'); a.value = btoa(a.value); }
  function cz(dir){ const sh=Number(document.getElementById('czshift').value)||0; const a=document.getElementById('czin'); const s=dir*sh;
    const rot=ch=>{ const A='ABCDEFGHIJKLMNOPQRSTUVWXYZ', aA='abcdefghijklmnopqrstuvwxyz';
      if (A.includes(ch)) return A[(A.indexOf(ch)+s%26+26)%26];
      if (aA.includes(ch)) return aA[(aA.indexOf(ch)+s%26+26)%26];
      return ch; };
    a.value = a.value.split('').map(rot).join('');
  }
  async function sha256btn(){ const a=document.getElementById('hbin'); const enc=new TextEncoder().encode(a.value);
    const buf=await crypto.subtle.digest('SHA-256', enc);
    a.value=[...new Uint8Array(buf)].map(x=>x.toString(16).padStart(2,'0')).join('');
  }

  // init
  document.addEventListener('DOMContentLoaded', ()=>{
    document.querySelectorAll('[data-step]').forEach(btn=>btn.addEventListener('click', ()=>showLevel(+btn.dataset.step)));
    document.querySelectorAll('[data-go]').forEach(btn=>btn.addEventListener('click', ()=>showLevel(+btn.dataset.go)));
    document.querySelectorAll('[data-check]').forEach(btn=>btn.addEventListener('click', ()=>doCheck(+btn.dataset.check)));
    document.getElementById('celebrateBtn')?.addEventListener('click', ()=>spawnConfetti());
    document.getElementById('resetBtn')?.addEventListener('click', ()=>{ localStorage.removeItem('currentLevel'); location.reload(); });
    document.getElementById('moreConfetti')?.addEventListener('click', ()=>spawnConfetti());
    document.getElementById('lbRefresh')?.addEventListener('click', loadLB);
    loadLB();

    // –±–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —É –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∏–Ω–ø—É—Ç–æ–≤
    document.querySelectorAll('input[type="text"]').forEach((el,i)=>{
      el.setAttribute('autocomplete','off');
      el.setAttribute('autocapitalize','off');
      el.setAttribute('autocorrect','off');
      el.setAttribute('spellcheck','false');
      el.setAttribute('name', `nohist_${Date.now()}_${i}_${Math.random().toString(36).slice(2,7)}`);
      el.setAttribute('readonly','readonly');
      el.addEventListener('focus', ()=> setTimeout(()=>el.removeAttribute('readonly'), 0), { once:true });
    });

    const saved=parseInt(localStorage.getItem('currentLevel')||'1',10);
    showLevel(isNaN(saved)?1:saved);
  });
</script>
</body>
</html>
